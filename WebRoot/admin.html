<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>青帝管理</title>

<link href="css/base.css" rel="stylesheet" type="text/css"/>
<link rel="stylesheet" href="css/ui.jqgrid.css" type="text/css"></link>
<link href="css/jquery-ui-1.10.3.custom.css" rel="stylesheet" type="text/css"/>
<link type="text/css" rel="stylesheet" href="css/Skins/Blue/jbox.css"/>

<!--<script type="text/javascript" src='js/jquery-1.9.1.js'></script>-->
<script type="text/javascript" src="js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="js/base.js"></script>
<script type="text/javascript" src="js/index.js"></script>
<script type="text/javascript" src='js/cTop.js'></script>
<script type="text/javascript" src="js/cMenu.js"></script>
<script type="text/javascript" src="js/jquery.jBox-2.3.min.js"></script>
<script type="text/javascript" src="js/i18n/jquery.jBox-zh-CN.js"></script>
<script type="text/javascript" src="js/jquery.jqGrid.src.js"></script>
<script type="text/javascript" src="js/i18n/grid.locale-cn.js"></script>

<link rel="Shortcut Icon" href="favicon.ico">
<script type="text/javascript">

function verify(type, id, value) {
    console.debug(type, id, value);
    var url = '/rest/metadata/';
    switch (type) {
        case 'mall':
            url += 'malls/';
    }
    url += id + '/' + (value ? 'positive' : 'negative');
    console.debug(url);

    var submit = function (v, h, f) {
        if (v == 'ok') {
            $.ajax({
                type: "POST",
                url: url,
                success: function (response) {
                    $('#List').trigger('reloadGrid');
                    console.debug(id + 'positive success');
                },
                error: function (response) {
                    console.debug(id + 'negative error');
                }
            });
        }
        else if (v == 'cancel')
            jBox.tip(v, 'info');

        return true; //close
    };

    $.jBox.confirm("确定激活吗？", "确认", submit);

}

function init() {
    commonInit();

    showNews();

    var height = $('#contentWrapper').height() - 75;

    var adminMenu = cMenu.create('menuWrapper', 'data/adminMenu.json', 0,
            function () {
                $('#List').GridUnload();
            },
            function () {
                jQuery("#List").jqGrid({
                    url: '/rest/metadata/malls/verify',
                    datatype: "json",
                    autowidth: true,
                    colNames: ['id', '姓名', '公告', '介绍', '借贷经历', '公司类型', '公司名称', '公司电话', '邮政编码', '网站', '电子邮件', '地址', '传真', '客户地区', '借贷用途', '特长', '借贷类型', '提交时间', '状态', '操作'],
                    colModel: [
                        {name: 'mid', index: 'mid', width: 55, frozen: true},
                        {name: 'name', index: 'name', width: 90, frozen: true},
                        {name: 'announcement', index: 'announcement', width: 200},
                        {name: 'introduce', index: 'introduce', width: 500, align: "right"},
                        {name: 'lendedyears', index: 'lendedyears', width: 80, align: "right"},
                        {name: 'ctype', index: 'ctype', width: 150, sortable: false},
                        {name: 'cname', index: 'cname', width: 150, sortable: false},
                        {name: 'cphonenumber', index: 'cphonenumber', width: 150, sortable: false},
                        {name: 'cpostcode', index: 'cpostcode', width: 150, sortable: false},
                        {name: 'csite', index: 'csite', width: 150, sortable: false},
                        {name: 'cemail', index: 'cemail', width: 150, sortable: false},
                        {name: 'caddress', index: 'caddress', width: 150, sortable: false},
                        {name: 'cfax', index: 'cfax', width: 150, sortable: false},
                        {name: 'clientlocation', index: 'clientlocation', width: 150, sortable: false},
                        {name: 'usesofloan', index: 'usesofloan', width: 150, sortable: false},
                        {name: 'speciality', index: 'speciality', width: 150, sortable: false},
                        {name: 'lendtype', index: 'lendtype', width: 150, sortable: false},
                        {name: 'time', index: 'time', width: 200},
                        {name: 'verify', index: 'verify', width: 50, sortable: false},
                        {name: 'act', index: 'act', width: 100}
                    ],
                    rowNum: Math.floor(height / 23),
                    rowList: [10, 20, 30],
                    pager: '#Pager',
                    sortname: 'mid',
                    viewrecords: true,
                    sortorder: "desc",
                    caption: "店铺认证",
                    gridview: true,
                    gridComplete: function () {
                        var ids = jQuery("#List").jqGrid('getDataIDs');
                        var data = jQuery("#List").jqGrid('getRowData');
                        for (var i = 0; i < ids.length; i++) {
                            // add action
                            var cl = ids[i];

                            // change status
                            var btnVerify = $('<input></input>');
                            if (data[i].verify == 1) {
                                jQuery("#List").jqGrid('setRowData', ids[i], {verify: "<div class='normalStatus' style='height:20px;width:20px;'></div>"});
                                btnVerify = "<input id='btnVerify' style='height:22px;width:50px;' type='button' value='不通过' onclick=\"verify('mall'," + data[i].mid + ",0)\"  />";
                            }
                            else {
                                jQuery("#List").jqGrid('setRowData', ids[i], {verify: "<div class='criticalStatus' style='height:20px;width:20px;'></div>"});
                                btnVerify = "<input id='btnVerify' style='height:22px;width:50px;' type='button' value='通过' onclick=\"verify('mall'," + data[i].mid + ",1)\"  />";
                            }
                            jQuery("#List").jqGrid('setRowData', ids[i], {act: btnVerify});
                        }
                    },
                });
                jQuery("#List").jqGrid('navGrid', '#Pager', {add: false, edit: false, del: false});
                $('.ui-jqgrid-bdiv').height(height);
            },
            function () {
                jQuery("#List").jqGrid({
                    url: '/rest/metadata/malls/verify',
                    datatype: "json",
                    autowidth: true,
                    colNames: ['id', '姓名', '公告', '介绍', '借贷经历', '公司类型', '公司名称', '公司电话', '邮政编码', '网站', '电子邮件', '地址', '传真', '客户地区', '借贷用途', '特长', '借贷类型', '提交时间', '状态', '操作'],
                    colModel: [
                        {name: 'mid', index: 'mid', width: 55, frozen: true},
                        {name: 'name', index: 'name', width: 90, frozen: true},
                        {name: 'announcement', index: 'announcement', width: 200},
                        {name: 'introduce', index: 'introduce', width: 500, align: "right"},
                        {name: 'lendedyears', index: 'lendedyears', width: 80, align: "right"},
                        {name: 'ctype', index: 'ctype', width: 150, sortable: false},
                        {name: 'cname', index: 'cname', width: 150, sortable: false},
                        {name: 'cphonenumber', index: 'cphonenumber', width: 150, sortable: false},
                        {name: 'cpostcode', index: 'cpostcode', width: 150, sortable: false},
                        {name: 'csite', index: 'csite', width: 150, sortable: false},
                        {name: 'cemail', index: 'cemail', width: 150, sortable: false},
                        {name: 'caddress', index: 'caddress', width: 150, sortable: false},
                        {name: 'cfax', index: 'cfax', width: 150, sortable: false},
                        {name: 'clientlocation', index: 'clientlocation', width: 150, sortable: false},
                        {name: 'usesofloan', index: 'usesofloan', width: 150, sortable: false},
                        {name: 'speciality', index: 'speciality', width: 150, sortable: false},
                        {name: 'lendtype', index: 'lendtype', width: 150, sortable: false},
                        {name: 'time', index: 'time', width: 200},
                        {name: 'verify', index: 'verify', width: 50, sortable: false},
                        {name: 'act', index: 'act', width: 100}
                    ],
                    rowNum: Math.floor(height / 23),
                    rowList: [10, 20, 30],
                    pager: '#Pager',
                    sortname: 'mid',
                    viewrecords: true,
                    sortorder: "desc",
                    caption: "产品认证",
                    gridview: true,
                    gridComplete: function () {
                        var ids = jQuery("#List").jqGrid('getDataIDs');
                        var data = jQuery("#List").jqGrid('getRowData');
                        for (var i = 0; i < ids.length; i++) {
                            // add action
                            var cl = ids[i];

                            // change status
                            var btnVerify = $('<input></input>');
                            if (data[i].verify == 1) {
                                jQuery("#List").jqGrid('setRowData', ids[i], {verify: "<div class='normalStatus' style='height:20px;width:20px;'></div>"});
                                btnVerify = "<input style='height:22px;width:50px;' type='button' value='不通过' onclick=\"verify('mall'," + data[i].mid + ",0)\"  />";
                            }
                            else {
                                jQuery("#List").jqGrid('setRowData', ids[i], {verify: "<div class='criticalStatus' style='height:20px;width:20px;'></div>"});
                                btnVerify = "<input style='height:22px;width:50px;' type='button' value='通过' onclick=\"verify('mall'," + data[i].mid + ",1)\"  />";
                            }
                            jQuery("#List").jqGrid('setRowData', ids[i], {act: btnVerify});
                        }
                    },
                });
                jQuery("#List").jqGrid('navGrid', '#Pager', {add: false, edit: false, del: false});
                $('.ui-jqgrid-bdiv').height(height);
            },
            function () {
                jQuery("#List").jqGrid({
                    url: '/rest/metadata/malls/verify',
                    datatype: "json",
                    autowidth: true,
                    colNames: ['id', '姓名', '公告', '介绍', '借贷经历', '公司类型', '公司名称', '公司电话', '邮政编码', '网站', '电子邮件', '地址', '传真', '客户地区', '借贷用途', '特长', '借贷类型', '提交时间', '状态', '操作'],
                    colModel: [
                        {name: 'mid', index: 'mid', width: 55, frozen: true},
                        {name: 'name', index: 'name', width: 90, frozen: true},
                        {name: 'announcement', index: 'announcement', width: 200},
                        {name: 'introduce', index: 'introduce', width: 500, align: "right"},
                        {name: 'lendedyears', index: 'lendedyears', width: 80, align: "right"},
                        {name: 'ctype', index: 'ctype', width: 150, sortable: false},
                        {name: 'cname', index: 'cname', width: 150, sortable: false},
                        {name: 'cphonenumber', index: 'cphonenumber', width: 150, sortable: false},
                        {name: 'cpostcode', index: 'cpostcode', width: 150, sortable: false},
                        {name: 'csite', index: 'csite', width: 150, sortable: false},
                        {name: 'cemail', index: 'cemail', width: 150, sortable: false},
                        {name: 'caddress', index: 'caddress', width: 150, sortable: false},
                        {name: 'cfax', index: 'cfax', width: 150, sortable: false},
                        {name: 'clientlocation', index: 'clientlocation', width: 150, sortable: false},
                        {name: 'usesofloan', index: 'usesofloan', width: 150, sortable: false},
                        {name: 'speciality', index: 'speciality', width: 150, sortable: false},
                        {name: 'lendtype', index: 'lendtype', width: 150, sortable: false},
                        {name: 'time', index: 'time', width: 200},
                        {name: 'verify', index: 'verify', width: 50, sortable: false},
                        {name: 'act', index: 'act', width: 100}
                    ],
                    rowNum: Math.floor(height / 23),
                    rowList: [10, 20, 30],
                    pager: '#Pager',
                    sortname: 'mid',
                    viewrecords: true,
                    sortorder: "desc",
                    caption: "需求认证",
                    gridview: true,
                    gridComplete: function () {
                        var ids = jQuery("#List").jqGrid('getDataIDs');
                        var data = jQuery("#List").jqGrid('getRowData');
                        for (var i = 0; i < ids.length; i++) {
                            // add action
                            var cl = ids[i];

                            // change status
                            var btnVerify = $('<input></input>');
                            if (data[i].verify == 1) {
                                jQuery("#List").jqGrid('setRowData', ids[i], {verify: "<div class='normalStatus' style='height:20px;width:20px;'></div>"});
                                btnVerify = "<input style='height:22px;width:50px;' type='button' value='不通过' onclick=\"verify('mall'," + data[i].mid + ",0)\"  />";
                            }
                            else {
                                jQuery("#List").jqGrid('setRowData', ids[i], {verify: "<div class='criticalStatus' style='height:20px;width:20px;'></div>"});
                                btnVerify = "<input style='height:22px;width:50px;' type='button' value='通过' onclick=\"verify('mall'," + data[i].mid + ",1)\"  />";
                            }
                            jQuery("#List").jqGrid('setRowData', ids[i], {act: btnVerify});
                        }
                    },
                });
                jQuery("#List").jqGrid('navGrid', '#Pager', {add: false, edit: false, del: false});
                $('.ui-jqgrid-bdiv').height(height);
            },
            function () {
                jQuery("#List").jqGrid({
                    url: '/rest/metadata/malls/verify',
                    datatype: "json",
                    autowidth: true,
                    colNames: ['id', '姓名', '公告', '介绍', '借贷经历', '公司类型', '公司名称', '公司电话', '邮政编码', '网站', '电子邮件', '地址', '传真', '客户地区', '借贷用途', '特长', '借贷类型', '提交时间', '状态', '操作'],
                    colModel: [
                        {name: 'mid', index: 'mid', width: 55, frozen: true},
                        {name: 'name', index: 'name', width: 90, frozen: true},
                        {name: 'announcement', index: 'announcement', width: 200},
                        {name: 'introduce', index: 'introduce', width: 500, align: "right"},
                        {name: 'lendedyears', index: 'lendedyears', width: 80, align: "right"},
                        {name: 'ctype', index: 'ctype', width: 150, sortable: false},
                        {name: 'cname', index: 'cname', width: 150, sortable: false},
                        {name: 'cphonenumber', index: 'cphonenumber', width: 150, sortable: false},
                        {name: 'cpostcode', index: 'cpostcode', width: 150, sortable: false},
                        {name: 'csite', index: 'csite', width: 150, sortable: false},
                        {name: 'cemail', index: 'cemail', width: 150, sortable: false},
                        {name: 'caddress', index: 'caddress', width: 150, sortable: false},
                        {name: 'cfax', index: 'cfax', width: 150, sortable: false},
                        {name: 'clientlocation', index: 'clientlocation', width: 150, sortable: false},
                        {name: 'usesofloan', index: 'usesofloan', width: 150, sortable: false},
                        {name: 'speciality', index: 'speciality', width: 150, sortable: false},
                        {name: 'lendtype', index: 'lendtype', width: 150, sortable: false},
                        {name: 'time', index: 'time', width: 200},
                        {name: 'verify', index: 'verify', width: 50, sortable: false},
                        {name: 'act', index: 'act', width: 100}
                    ],
                    rowNum: Math.floor(height / 23),
                    rowList: [10, 20, 30],
                    pager: '#Pager',
                    sortname: 'mid',
                    viewrecords: true,
                    sortorder: "desc",
                    caption: "资讯认证",
                    gridview: true,
                    gridComplete: function () {
                        var ids = jQuery("#List").jqGrid('getDataIDs');
                        var data = jQuery("#List").jqGrid('getRowData');
                        for (var i = 0; i < ids.length; i++) {
                            // add action
                            var cl = ids[i];

                            // change status
                            var btnVerify = $('<input></input>');
                            if (data[i].verify == 1) {
                                jQuery("#List").jqGrid('setRowData', ids[i], {verify: "<div class='normalStatus' style='height:20px;width:20px;'></div>"});
                                btnVerify = "<input style='height:22px;width:50px;' type='button' value='不通过' onclick=\"verify('mall'," + data[i].mid + ",0)\"  />";
                            }
                            else {
                                jQuery("#List").jqGrid('setRowData', ids[i], {verify: "<div class='criticalStatus' style='height:20px;width:20px;'></div>"});
                                btnVerify = "<input style='height:22px;width:50px;' type='button' value='通过' onclick=\"verify('mall'," + data[i].mid + ",1)\"  />";
                            }
                            jQuery("#List").jqGrid('setRowData', ids[i], {act: btnVerify});
                        }
                    },
                });
                jQuery("#List").jqGrid('navGrid', '#Pager', {add: false, edit: false, del: false});
                $('.ui-jqgrid-bdiv').height(height);
            },
            function() {
                jQuery("#List").jqGrid({
                    url:'/rest/metadata/malls/verify',
                    datatype: "json",
                    autowidth: true,
                    colNames:['id','姓名','公告','介绍','借贷经历','公司类型','公司名称','公司电话','邮政编码','网站','电子邮件','地址','传真','客户地区','借贷用途','特长','借贷类型','提交时间','状态','操作'],
                    colModel:[
                        {name:'mid',index:'mid', width:55,frozen : true},
                        {name:'name',index:'name', width:90,frozen : true},
                        {name:'announcement',index:'announcement', width:200},
                        {name:'introduce',index:'introduce', width:500, align:"right"},
                        {name:'lendedyears',index:'lendedyears', width:80, align:"right"},
                        {name:'ctype',index:'ctype', width:150, sortable:false},
                        {name:'cname',index:'cname', width:150, sortable:false},
                        {name:'cphonenumber',index:'cphonenumber', width:150, sortable:false},
                        {name:'cpostcode',index:'cpostcode',width:150,sortable:false},
                        {name:'csite',index:'csite', width:150, sortable:false},
                        {name:'cemail',index:'cemail', width:150, sortable:false},
                        {name:'caddress',index:'caddress', width:150, sortable:false},
                        {name:'cfax',index:'cfax', width:150, sortable:false},
                        {name:'clientlocation',index:'clientlocation', width:150, sortable:false},
                        {name:'usesofloan',index:'usesofloan', width:150, sortable:false},
                        {name:'speciality',index:'speciality', width:150, sortable:false},
                        {name:'lendtype',index:'lendtype', width:150, sortable:false},
                        {name:'time',index:'time',width:200},
                        {name:'verify',index:'verify', width:50, sortable:false},
                        {name:'act',index:'act',width:100}
                    ],
                    rowNum: Math.floor(height / 23),
                    rowList:[10,20,30],
                    pager: '#Pager',
                    sortname: 'mid',
                    viewrecords: true,
                    sortorder: "desc",
                    caption:"交易认证",
                    gridview: true,
                    gridComplete: function(){
                        var ids = jQuery("#List").jqGrid('getDataIDs');
                        var data =  jQuery("#List").jqGrid('getRowData');
                        for(var i=0;i < ids.length;i++){
                            // add action
                            var cl = ids[i];

                            // change status
                            var btnVerify = $('<input></input>');
                            if (data[i].verify == 1) {
                                jQuery("#List").jqGrid('setRowData',ids[i],{verify:"<div class='normalStatus' style='height:20px;width:20px;'></div>"});
                                btnVerify = "<input style='height:22px;width:50px;' type='button' value='不通过' onclick=\"verify('mall',"+data[i].mid+",0)\"  />";
                            }
                            else {
                                jQuery("#List").jqGrid('setRowData',ids[i],{verify:"<div class='criticalStatus' style='height:20px;width:20px;'></div>"});
                                btnVerify = "<input style='height:22px;width:50px;' type='button' value='通过' onclick=\"verify('mall',"+data[i].mid+",1)\"  />";
                            }
                            jQuery("#List").jqGrid('setRowData',ids[i],{act:btnVerify});
                        }
                    },
                });
                jQuery("#List").jqGrid('navGrid','#Pager',{add:false,edit:false,del:false});
                $('.ui-jqgrid-bdiv').height(height);
            }
    );

}
</script>

</head>

<body onload='init()'>
<div id="site-header-container" class="site-header-container page-container">
</div>
<div id="searchboxContainer" class="searchboxContainer">
</div>
<div id="mainContainerWide" class="mainContainerWide">
    <div id="menuWrapper" class="menuWrapper"></div>
    <div id="contentWrapper" class="contentWrapper">
        <table id="List"></table>
        <div id="Pager"></div>
    </div>
</div>
<div id="footContainer" class="footContainer">
</div>
</body>
</html>

