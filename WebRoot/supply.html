<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <title>贷款供应</title>

    <link href="css/base.css" rel="stylesheet" type="text/css"/>
    <link href="css/flexisel.css" rel="stylesheet" type="text/css"/>
    <link rel="stylesheet" href="css/chosen.css"/>
    <link rel="stylesheet" type="text/css" media="all" href="css/bootstrap.css" />

    <script type="text/javascript" src='js/jquery-1.9.1.js'></script>
    <script type="text/javascript" src="js/base.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script type="text/javascript" src='js/cTop.js'></script>
    <script type="text/javascript" src="js/jquery.flexisel.js"></script>
    <script type="text/javascript" src="js/jquery.esn.autobrowse.js"></script>
    <script type="text/javascript" src="js/jstorage.js"></script>
    <script type="text/javascript" src="js/chosen.jquery.js"></script>
    <script type="text/javascript" src="js/cArea.js"></script>
    <script type="text/javascript" src="js/cSearch.js"></script>

    <link rel="Shortcut Icon" href="favicon.ico">

    <script type="text/javascript">
        function init() {
            commonInit();
            $('#hot').load('/data/bankFlex.html', function () {
                $("#bankUl").flexisel({
                    visibleItems: 5,
                    animationSpeed: 1000,
                    autoPlay: true,
                    autoPlaySpeed: 3000,
                    pauseOnHover: true,
                    enableResponsiveBreakpoints: true,
                    responsiveBreakpoints: {
                        portrait: {
                            changePoint: 480,
                            visibleItems: 1
                        },
                        landscape: {
                            changePoint: 640,
                            visibleItems: 2
                        },
                        tablet: {
                            changePoint: 768,
                            visibleItems: 3
                        }
                    }
                });
            });

            $('#filter').load('/js/templates/supplyFilter.html', function () {
                $.cArea(DEFAULT_AREA);
                count = 10;//getFilterCount("type", type, MALL);

                $("#clientSel").change(function () {
                    search();
                });
                $("#ueseofloanSel").change(function () {
                    search();
                });
                $("#searchAmount").click(function () {
                    search();
                });
                $("#searchLocation").click(function () {
                    search();
                });
                search();
            });
        }
        function search() {
            $(".page .items").empty();

            // default size & page
            /*
             第一次获得的item个数是第二次的offset。需要计算page，防止载入重复的item
             */
            var size = 10;
            var page = 1;
            $(".page .items").autobrowse(
                    {
                        url: function (offset) {
                            var client = "", usesofloan = "", min = 0, max = 10, location = $("#provinceSel").val() + $('#citySel').val();
                            if ($("#clientSel").val() != "不限") {
                                client = $("#clientSel").val();
                            }
                            if ($("#ueseofloanSel").val() != "不限") {
                                usesofloan = $("#ueseofloanSel").val();
                            }
                            if ($("#min").val() != "0" || $("#max").val() != "10") {
                                min = $("#min").val();
                                max = $("#max").val();
                            }
                            $.ajax({
                                url: "/rest/metadata/product/nkeys/count?&searchField=clientLocation&searchString=" + location + "&searchOper=eq&searchField=usesofloan&searchString=" + usesofloan + "&searchOper=cn&searchField=client&searchString=" + client + "&searchOper=cn&searchField=min&searchString=" + min + "&searchOper=bw&searchField=max&searchString=" + max + "&searchOper=ew",
                                type: 'HEAD',
                                success: function(res, status, xhr) {
                                    $("#searchCount").html(xhr.getResponseHeader("count"));
                                },
                                error: function(response) {
                                    console.error(response);
                                }
                            });
                            console.debug("/rest/metadata/product/nkeys?rows=" + 10 + "&page=" + 1 + "&searchField=clientLocation&searchString=" + location + "&searchOper=eq&searchField=usesofloan&searchString=" + usesofloan + "&searchOper=cn&searchField=client&searchString=" + client + "&searchOper=cn&searchField=min&searchString=" + min + "&searchOper=bw&searchField=max&searchString=" + max + "&searchOper=ew&sidx=postDate&sord=asc");
                            return "/rest/metadata/product/nkeys?rows=" + 10 + "&page=" + 1 + "&searchField=clientLocation&searchString=" + location + "&searchOper=eq&searchField=usesofloan&searchString=" + usesofloan + "&searchOper=cn&searchField=client&searchString=" + client + "&searchOper=cn&searchField=min&searchString=" + min + "&searchOper=bw&searchField=max&searchString=" + max + "&searchOper=ew&sidx=postDate&sord=asc";//"/data/tests/supplyWaterfall.json";
                        },
                        template: function (response) {
                            var markup = '';
                            for (var i = 0; i < response.length; i++) {
                                markup += '<a target="_blank" href="' + getLink(PRODUCT, response[i].mall.id) + '"><div class="hover" style="width:786px;height:98px;border-top: 1px solid #ddd; border-bottom: 1px solid #ddd; padding: 8px 0px;">' +
                                        '<div class="p_left"><img width="48" height="48" alt="' + response[i].poster.lastname + '经理" src="' + response[i].poster.avatar + '">' +
                                        '<p>' + response[i].poster.lastname + '经理</p>' +
                                        '</div>' +
                                        '<div class="p_right" style="box-sizing: content-box;">' +
                                        '<h5 style="margin-top: 0px;">' + response[i].pName + '</h5>' +
                                        '<div class="clear_both"></div>' +
                                        '<span class="p1">' + response[i].clientLocation + '</span>' +
                                        '<span class="p2">贷款用途：' + response[i].usesofloan + '</span>' +
                                        '<span class="p2">抵押贷款</span>' +
                                        '<span style="width: 40px">额度：</span>' +
                                        '<span class="p4">' + response[i].min + '万-' + response[i].max + '万</span>' +
                                        '<div class="clear_both"></div>' +
                                        '<p>' + response[i].content + '.</p>' +
                                        '</div></div></a>';
                            }
                            ;

                            return markup;
                        },
                        itemsReturned: function (response) {
                            return response.length;
                        },
                        offset: 0,
                        loader: '<div class="loader"></div>',
                        useCache: true,
                        expiration: 1
                    }
            );
        }
    </script>

</head>

<body onload='init()'>
<div id="site-header-container" class="site-header-container page-container">
</div>
<div id="searchboxContainer" class="searchboxContainer">
</div>
<div id="mainContainer2" class="mainContainer2">
    <div id="mainContainerCenterLeft" class="mainContainerCenterLeft">
        <div id="hot" class="hot">
        </div>
        <div id="filter" style="width: 786px;height: 160px; border: 1px solid rgb(221,221,221);border-radius: 5px;" class="filter container">
        </div>
        <h6><small>找到约 <span id="searchCount"></span> 条结果</small></h6>
        <div id="waterfall" class="waterfall">

            <div class='page'>
                <div class='items'></div>
            </div>
        </div>
    </div>
    <div id="recommendContainerRight" class="recommendContainerRight"></div>
    <div style="clear:both;"></div>
</div>
</div>
<div id="footContainer" class="footContainer">
</div>
<!-- JiaThis Button BEGIN -->
<script type="text/javascript" src="http://v3.jiathis.com/code/jiathis_r.js?uid=1368719936583355"
        charset="utf-8"></script>
<!-- JiaThis Button END -->
<!-- UJian Button BEGIN -->
<script type="text/javascript" src="http://v1.ujian.cc/code/ujian.js?type=slide"></script>
<!-- UJian Button END -->
</body>
</html>